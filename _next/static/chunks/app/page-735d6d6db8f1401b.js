(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{4030:(e,t,s)=>{Promise.resolve().then(s.bind(s,8795))},8795:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>N});var a,n=s(5155),i=s(2115),l=s(3139);function r(e){return e?"".concat(e.slice(0,6),"...").concat(e.slice(-4)):""}function c(e){return new Date(1e3*e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}function d(){let{selectedAccount:e,chainId:t,connect:s,disconnect:a,switchChain:i}=(0,l.U)();return(0,n.jsx)("div",{className:"flex items-center gap-4",children:e?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-sm text-gray-400",children:31337===t?"Localhost":0xaa36a7===t?"Sepolia":t?"Chain ".concat(t):"Unknown"}),(0,n.jsx)("span",{className:"px-3 py-1 bg-blue-600 rounded-lg text-sm",children:r(e)})]}),(0,n.jsx)("button",{onClick:a,className:"px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm transition-colors",children:"断开连接"})]}):(0,n.jsx)("button",{onClick:s,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm transition-colors",children:"连接钱包"})})}var o=function(e){return e[e.Active=0]="Active",e[e.Ended=1]="Ended",e[e.Cancelled=2]="Cancelled",e}({}),u=function(e){return e[e.PublicOnEnd=0]="PublicOnEnd",e[e.PrivateToOwner=1]="PrivateToOwner",e[e.PrivateToDAO=2]="PrivateToDAO",e}({});function p(e){let{onSubmit:t,isLoading:s}=e,[a,l]=(0,i.useState)(""),[r,c]=(0,i.useState)(""),[d,o]=(0,i.useState)(["",""]),[p,m]=(0,i.useState)(7),[x,y]=(0,i.useState)(u.PublicOnEnd);return(0,n.jsxs)("form",{onSubmit:e=>{e.preventDefault();let s=d.filter(e=>e.trim());if(s.length<2)return void alert("请至少填写2个选项！");t(a,r,s,24*p*3600,x),l(""),c(""),o(["",""]),m(7),y(u.PublicOnEnd)},className:"card-glass p-8 space-y-6 fade-in",children:[(0,n.jsx)("div",{className:"flex items-center justify-between mb-6",children:(0,n.jsx)("h2",{className:"text-3xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent",children:"\uD83D\uDDF3️ 创建提案 | Create Proposal"})}),(0,n.jsxs)("div",{className:"space-y-5",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:"\uD83D\uDCDD 标题 | Title"}),(0,n.jsx)("input",{type:"text",value:a,onChange:e=>l(e.target.value),className:"input-field w-full",placeholder:"例如：是否采用新的治理方案？",required:!0,disabled:s})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:"\uD83D\uDCC4 描述 | Description"}),(0,n.jsx)("textarea",{value:r,onChange:e=>c(e.target.value),rows:4,className:"input-field w-full resize-none",placeholder:"详细描述提案内容...",required:!0,disabled:s})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,n.jsxs)("label",{className:"block text-sm font-medium text-gray-300",children:["✅ 投票选项 | Options (",d.length,"/10)"]}),(0,n.jsx)("button",{type:"button",onClick:()=>{d.length<10&&o([...d,""])},disabled:d.length>=10||s,className:"text-sm px-3 py-1 bg-blue-500/20 hover:bg-blue-500/30 text-blue-300 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"+ 添加选项"})]}),(0,n.jsx)("div",{className:"space-y-3",children:d.map((e,t)=>(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsxs)("span",{className:"text-gray-400 font-mono w-8",children:[t,":"]}),(0,n.jsx)("input",{type:"text",value:e,onChange:e=>((e,t)=>{let s=[...d];s[e]=t,o(s)})(t,e.target.value),className:"input-field flex-1",placeholder:"选项 ".concat(t," (例如：赞成、反对、弃权)"),required:!0,disabled:s}),d.length>2&&(0,n.jsx)("button",{type:"button",onClick:()=>{d.length>2&&o(d.filter((e,s)=>s!==t))},disabled:s,className:"px-3 py-2 bg-red-500/20 hover:bg-red-500/30 text-red-300 rounded-lg transition-colors",children:"✕"})]},t))})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:"⏱️ 投票时长 | Duration"}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("input",{type:"number",value:p,onChange:e=>m(parseInt(e.target.value)),min:1,className:"input-field w-full pr-12",required:!0,disabled:s}),(0,n.jsx)("span",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 text-sm",children:"天"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:"\uD83D\uDD12 结果策略 | Result Strategy"}),(0,n.jsxs)("select",{value:x,onChange:e=>y(parseInt(e.target.value)),className:"input-field w-full",disabled:s,children:[(0,n.jsx)("option",{value:u.PublicOnEnd,children:"\uD83D\uDCE2 到期公开 | Public"}),(0,n.jsx)("option",{value:u.PrivateToOwner,children:"\uD83D\uDC64 定向提案者 | Owner"}),(0,n.jsx)("option",{value:u.PrivateToDAO,children:"\uD83C\uDFDB️ 定向DAO | DAO"})]})]})]}),(0,n.jsx)("button",{type:"submit",disabled:s,className:"btn-primary w-full disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:s?(0,n.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,n.jsx)("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"处理中..."]}):"\uD83D\uDE80 创建提案 | Create"})]})]})}function m(e){let{proposalId:t,options:s,isEnded:a,resultsRevealed:l,onRequestAccess:r,onDecryptResults:c,isLoading:d}=e,[o,u]=(0,i.useState)(),[p,m]=(0,i.useState)(!1),x=async()=>{let e=await c();e&&u(e)},y=(e,t)=>t===BigInt(0)?0:Number(e*BigInt(100)/t),h=(()=>{if(!o)return[];let e=o.optionVotes.reduce((e,t)=>t>e?t:e,BigInt(0));return o.optionVotes.map((t,s)=>t===e?s:-1).filter(e=>-1!==e)})();return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("button",{onClick:()=>m(!p),className:"w-full btn-secondary flex items-center justify-between",children:[(0,n.jsx)("span",{children:"\uD83D\uDCCA 投票统计 | Vote Statistics"}),(0,n.jsx)("span",{className:"text-2xl",children:p?"▼":"▶"})]}),p&&(0,n.jsxs)("div",{className:"bg-white/5 rounded-xl p-6 space-y-6 border border-white/10",children:[!a&&(0,n.jsxs)("div",{className:"text-center py-8",children:[(0,n.jsx)("div",{className:"text-4xl mb-3",children:"\uD83D\uDD12"}),(0,n.jsx)("div",{className:"text-yellow-300 font-semibold mb-2",children:"投票进行中 | Voting In Progress"}),(0,n.jsx)("div",{className:"text-sm text-gray-400",children:"提案结束后才能查看统计结果"})]}),a&&!l&&(0,n.jsxs)("div",{className:"text-center py-6",children:[(0,n.jsx)("div",{className:"text-4xl mb-3",children:"\uD83D\uDD10"}),(0,n.jsx)("div",{className:"text-blue-300 font-semibold mb-4",children:"需要授权访问结果 | Access Required"}),(0,n.jsx)("button",{onClick:r,disabled:d,className:"btn-primary",children:"\uD83D\uDD13 请求访问权限 | Request Access"})]}),a&&l&&!o&&(0,n.jsxs)("div",{className:"text-center py-6",children:[(0,n.jsx)("div",{className:"text-4xl mb-3",children:"\uD83D\uDD11"}),(0,n.jsx)("div",{className:"text-green-300 font-semibold mb-4",children:"准备解密结果 | Ready to Decrypt"}),(0,n.jsx)("button",{onClick:x,disabled:d,className:"btn-primary",children:"\uD83D\uDD10 解密查看结果 | Decrypt Results"})]}),o&&(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-xl p-5 border border-blue-500/20",children:[(0,n.jsx)("h3",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:"\uD83D\uDCC8 总体统计 | Overall Statistics"}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-3xl font-bold text-blue-400",children:o.totalVoters.toString()}),(0,n.jsx)("div",{className:"text-sm text-gray-400 mt-1",children:"总投票数 | Total Votes"})]}),(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-3xl font-bold text-purple-400",children:s.length}),(0,n.jsx)("div",{className:"text-sm text-gray-400 mt-1",children:"投票选项 | Options"})]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:"\uD83C\uDFAF 投票结果 | Voting Results"}),(0,n.jsx)("div",{className:"space-y-4",children:o.optionVotes.map((e,t)=>{let a=y(e,o.totalVoters),i=h.includes(t);return(0,n.jsxs)("div",{className:"p-4 rounded-xl transition-all ".concat(i?"bg-gradient-to-r from-yellow-500/20 to-orange-500/20 border-2 border-yellow-500/50 ring-2 ring-yellow-500/30":"bg-white/5 border border-white/10"),children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[i&&(0,n.jsx)("span",{className:"text-2xl",children:"\uD83C\uDFC6"}),(0,n.jsx)("span",{className:"text-white font-semibold text-lg",children:s[t]||"选项 ".concat(t)})]}),(0,n.jsxs)("div",{className:"text-right",children:[(0,n.jsxs)("div",{className:"text-xl font-bold text-white",children:[e.toString()," 票"]}),(0,n.jsxs)("div",{className:"text-sm text-gray-400",children:[a,"%"]})]})]}),(0,n.jsx)("div",{className:"vote-bar",children:(0,n.jsx)("div",{className:"vote-bar-fill ".concat(i?"bg-gradient-to-r from-yellow-500 to-orange-500":""),style:{width:"".concat(a,"%")}})}),i&&(0,n.jsx)("div",{className:"mt-2 text-center text-yellow-300 text-sm font-semibold animate-pulse",children:"⭐ 获胜选项 | Winner ⭐"})]},t)})})]}),(0,n.jsxs)("div",{className:"bg-white/5 rounded-xl p-5 border border-white/10",children:[(0,n.jsx)("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:"\uD83D\uDCCA 投票分布 | Vote Distribution"}),(0,n.jsx)("div",{className:"space-y-2",children:o.optionVotes.map((e,t)=>{let a=y(e,o.totalVoters);return(0,n.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,n.jsx)("div",{className:"w-24 text-gray-400 truncate",children:s[t]||"选项 ".concat(t)}),(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("div",{className:"flex-1 h-2 bg-white/10 rounded-full overflow-hidden",children:(0,n.jsx)("div",{className:"h-full bg-gradient-to-r from-blue-500 to-purple-600",style:{width:"".concat(a,"%")}})}),(0,n.jsxs)("span",{className:"text-gray-300 w-12 text-right",children:[a,"%"]})]})})]},t)})})]}),(0,n.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-center text-sm",children:[(0,n.jsxs)("div",{className:"bg-white/5 rounded-lg p-3",children:[(0,n.jsx)("div",{className:"text-gray-400 mb-1",children:"最高得票"}),(0,n.jsxs)("div",{className:"text-white font-bold",children:[Math.max(...o.optionVotes.map(e=>Number(e)))," 票"]})]}),(0,n.jsxs)("div",{className:"bg-white/5 rounded-lg p-3",children:[(0,n.jsx)("div",{className:"text-gray-400 mb-1",children:"最低得票"}),(0,n.jsxs)("div",{className:"text-white font-bold",children:[Math.min(...o.optionVotes.map(e=>Number(e)))," 票"]})]}),(0,n.jsxs)("div",{className:"bg-white/5 rounded-lg p-3",children:[(0,n.jsx)("div",{className:"text-gray-400 mb-1",children:"平均票数"}),(0,n.jsxs)("div",{className:"text-white font-bold",children:[(Number(o.totalVoters)/s.length).toFixed(1)," 票"]})]})]})]})]})]})}function x(e){let{proposal:t,hasVoted:s,canVote:a,onVote:l,onEnd:d,onForceEnd:p,onAllowResults:x,onDecryptResults:y,isLoading:h,options:g=[],currentUserAddress:b}=e,[v,j]=(0,i.useState)(0),[f,N]=(0,i.useState)(!1),w=t.status===o.Ended,D=t.status===o.Cancelled,T=t.status===o.Active,C=1e3*Number(t.endTime)<Date.now();return(0,n.jsxs)("div",{className:"proposal-card fade-in",children:[(0,n.jsx)("div",{className:"flex items-start justify-between mb-4",children:(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,n.jsx)("h3",{className:"text-2xl font-bold text-white",children:t.title}),(0,n.jsx)("span",{className:"status-badge ".concat(D?"status-cancelled":w?"status-ended":C?"bg-orange-500/20 text-orange-300 border border-orange-500/30":"status-active"),children:D?"已取消":w?"已结束":C?"已过期":"进行中"})]}),(0,n.jsx)("p",{className:"text-gray-300 text-sm leading-relaxed mb-3",children:t.description}),(0,n.jsxs)("div",{className:"flex flex-wrap gap-4 text-sm text-gray-400",children:[(0,n.jsxs)("span",{className:"flex items-center gap-1",children:["\uD83D\uDC64 ",r(t.proposer)]}),(0,n.jsxs)("span",{className:"flex items-center gap-1",children:["✅ ",g.length||t.optionCount," 个选项"]}),(0,n.jsx)("span",{className:"flex items-center gap-1",children:(e=>{switch(e){case u.PublicOnEnd:return"\uD83D\uDCE2 公开";case u.PrivateToOwner:return"\uD83D\uDC64 提案者";case u.PrivateToDAO:return"\uD83C\uDFDB️ DAO"}})(t.resultStrategy)})]}),(0,n.jsxs)("div",{className:"flex gap-4 text-sm text-gray-500 mt-2",children:[(0,n.jsxs)("span",{children:["\uD83D\uDD50 开始: ",c(Number(t.startTime))]}),(0,n.jsxs)("span",{children:["⏰ 结束: ",c(Number(t.endTime))]})]})]})}),T&&!C&&!s&&a&&(0,n.jsx)("div",{className:"border-t border-white/10 pt-4 mt-4",children:f?(0,n.jsxs)("div",{className:"space-y-4 bg-white/5 rounded-xl p-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium mb-3 text-gray-300",children:"选择投票选项 | Select Option"}),(0,n.jsx)("div",{className:"space-y-2",children:g.map((e,t)=>(0,n.jsxs)("label",{className:"flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-all ".concat(v===t?"bg-blue-500/30 border-2 border-blue-500":"bg-white/5 border-2 border-white/10 hover:bg-white/10"),children:[(0,n.jsx)("input",{type:"radio",name:"option",value:t,checked:v===t,onChange:()=>j(t),className:"w-5 h-5 text-blue-500"}),(0,n.jsx)("span",{className:"text-white font-medium",children:e||"选项 ".concat(t)})]},t))})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("button",{onClick:()=>{l(Number(t.id),{option:v}),N(!1)},disabled:h,className:"btn-primary flex-1",children:"✅ 确认投票 | Submit"}),(0,n.jsx)("button",{onClick:()=>N(!1),disabled:h,className:"px-4 py-2 bg-gray-600/50 hover:bg-gray-600/70 rounded-xl transition-colors",children:"取消"})]})]}):(0,n.jsx)("button",{onClick:()=>N(!0),disabled:h,className:"btn-secondary w-full",children:"\uD83D\uDDF3️ 投票 | Vote"})}),s&&(0,n.jsxs)("div",{className:"text-green-400 text-sm flex items-center gap-2 bg-green-500/10 px-4 py-2 rounded-lg border border-green-500/30",children:[(0,n.jsx)("span",{className:"text-lg",children:"✅"}),"您已投票 | You have voted"]}),T&&!C&&b&&b.toLowerCase()===t.proposer.toLowerCase()&&(0,n.jsxs)("div",{className:"border-t border-white/10 pt-4 mt-4",children:[(0,n.jsxs)("button",{onClick:()=>p(Number(t.id)),disabled:h,className:"btn-danger w-full flex items-center justify-center gap-2",children:[(0,n.jsx)("span",{children:"⚡"}),(0,n.jsx)("span",{children:"提前结束投票 | Force End"}),(0,n.jsx)("span",{className:"text-sm opacity-75",children:"(测试用)"})]}),(0,n.jsx)("p",{className:"text-xs text-gray-400 text-center mt-2",children:"仅提案创建者可提前结束 | Only proposer can force end"})]}),T&&C&&!w&&(0,n.jsx)("button",{onClick:()=>d(Number(t.id)),disabled:h,className:"btn-danger w-full mt-4",children:"\uD83C\uDFC1 结束提案 | End Proposal"}),(0,n.jsx)("div",{className:"border-t border-white/10 pt-4 mt-4",children:(0,n.jsx)(m,{proposalId:Number(t.id),options:g,isEnded:w,resultsRevealed:t.resultsRevealed,onRequestAccess:()=>x(Number(t.id)),onDecryptResults:async()=>await y(Number(t.id),g.length||t.optionCount),isLoading:h})})]})}function y(e){let{proposals:t}=e,s={total:t.length,active:t.filter(e=>e.status===o.Active).length,ended:t.filter(e=>e.status===o.Ended).length,cancelled:t.filter(e=>e.status===o.Cancelled).length};return(0,n.jsxs)("div",{className:"card-glass p-6 space-y-6 fade-in",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent",children:"\uD83D\uDCDC 提案历史 | Proposal History"}),(0,n.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,n.jsxs)("div",{className:"bg-white/5 rounded-xl p-4 text-center",children:[(0,n.jsx)("div",{className:"text-3xl font-bold text-blue-400",children:s.total}),(0,n.jsx)("div",{className:"text-sm text-gray-400 mt-1",children:"总提案"})]}),(0,n.jsxs)("div",{className:"bg-white/5 rounded-xl p-4 text-center",children:[(0,n.jsx)("div",{className:"text-3xl font-bold text-green-400",children:s.active}),(0,n.jsx)("div",{className:"text-sm text-gray-400 mt-1",children:"进行中"})]}),(0,n.jsxs)("div",{className:"bg-white/5 rounded-xl p-4 text-center",children:[(0,n.jsx)("div",{className:"text-3xl font-bold text-purple-400",children:s.ended}),(0,n.jsx)("div",{className:"text-sm text-gray-400 mt-1",children:"已结束"})]}),(0,n.jsxs)("div",{className:"bg-white/5 rounded-xl p-4 text-center",children:[(0,n.jsx)("div",{className:"text-3xl font-bold text-gray-400",children:s.cancelled}),(0,n.jsx)("div",{className:"text-sm text-gray-400 mt-1",children:"已取消"})]})]}),(0,n.jsx)("div",{className:"space-y-3 max-h-96 overflow-y-auto custom-scrollbar",children:t.slice(0,10).map(e=>(0,n.jsx)("div",{className:"bg-white/5 hover:bg-white/10 rounded-lg p-4 transition-all cursor-pointer",children:(0,n.jsxs)("div",{className:"flex items-start justify-between",children:[(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("h3",{className:"font-medium text-white",children:e.title}),(0,n.jsx)("p",{className:"text-sm text-gray-400 mt-1",children:c(Number(e.startTime))})]}),(0,n.jsx)("div",{className:"flex flex-col items-end gap-2",children:(0,n.jsx)("span",{className:"status-badge ".concat(e.status===o.Active?"status-active":e.status===o.Ended?"status-ended":"status-cancelled"),children:e.status===o.Active?"进行中":e.status===o.Ended?"已结束":"已取消"})})]})},e.id.toString()))})]})}function h(e){let{proposals:t,userAddress:s,votedProposalIds:a}=e,i=t.filter(e=>a.has(Number(e.id))),l=t.length>0?Math.round(i.length/t.length*100):0;return(0,n.jsxs)("div",{className:"card-glass p-6 space-y-6 fade-in",children:[(0,n.jsx)("h2",{className:"text-2xl font-bold bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent",children:"\uD83D\uDCCA 投票统计 | Voting Statistics"}),s?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-xl p-5 border border-blue-500/20",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,n.jsx)("div",{className:"w-12 h-12 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center text-2xl",children:"\uD83D\uDC64"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-sm text-gray-400",children:"当前地址"}),(0,n.jsx)("div",{className:"font-mono text-white",children:r(s)})]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-blue-400",children:i.length}),(0,n.jsx)("div",{className:"text-sm text-gray-400",children:"我的投票"})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"text-2xl font-bold text-purple-400",children:[l,"%"]}),(0,n.jsx)("div",{className:"text-sm text-gray-400",children:"参与率"})]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-white mb-3 flex items-center gap-2",children:"\uD83D\uDDF3️ 我的投票历史"}),(0,n.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto custom-scrollbar",children:i.length>0?i.map(e=>(0,n.jsx)("div",{className:"bg-white/5 hover:bg-white/10 rounded-lg p-3 transition-all",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"font-medium text-white text-sm",children:e.title}),(0,n.jsxs)("div",{className:"text-xs text-gray-400 mt-1",children:["提案 #",e.id.toString()]})]}),(0,n.jsx)("div",{className:"text-green-400 text-xl",children:"✓"})]})},e.id.toString())):(0,n.jsxs)("div",{className:"text-center py-8 text-gray-400",children:[(0,n.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDDF3️"}),(0,n.jsx)("div",{className:"text-sm",children:"您还没有参与投票"}),(0,n.jsx)("div",{className:"text-xs mt-1",children:"快去为提案投票吧！"})]})})]})]}):(0,n.jsxs)("div",{className:"text-center py-8 text-gray-400",children:[(0,n.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDD0C"}),(0,n.jsx)("div",{className:"text-sm",children:"请先连接钱包"}),(0,n.jsx)("div",{className:"text-xs mt-1",children:"连接后查看您的投票统计"})]})]})}var g=s(3338),b=s(8343),v=s(6916);function j(){return Math.floor(Date.now()/1e3)}(a||(a={})).loadOrSign=async function(e,t,s,a){let n=await s.getAddress(),i=function(e,t){let s=[...t].sort();return"".concat("fhevm_decryption_sig","_").concat(e,"_").concat(s.join("_"))}(n,t),l=await a.getItem(i);if(l)try{let e=JSON.parse(l),t=j(),s=e.startTimestamp+24*e.durationDays*3600;if(t<s)return console.log("[FhevmDecryptionSignature] Using cached signature"),e;console.log("[FhevmDecryptionSignature] Cached signature expired")}catch(e){console.log("[FhevmDecryptionSignature] Invalid cached signature:",e)}try{console.log("[FhevmDecryptionSignature] Creating new signature...");let{publicKey:l,privateKey:r}=e.generateKeypair();console.log("[FhevmDecryptionSignature] Generated FHEVM keypair");let c=j(),d=[...t].sort(),o=e.createEIP712(l,d,c,365);console.log("[FhevmDecryptionSignature] EIP-712 structure created");let u=await s.signTypedData(o.domain,{UserDecryptRequestVerification:o.types.UserDecryptRequestVerification},o.message);console.log("[FhevmDecryptionSignature] ✅ Signature created successfully");let p={privateKey:r,publicKey:l,signature:u,contractAddresses:d,userAddress:n,startTimestamp:c,durationDays:365};return await a.setItem(i,JSON.stringify(p)),console.log("[FhevmDecryptionSignature] Signature cached"),p}catch(e){return console.error("[FhevmDecryptionSignature] ❌ Failed to create signature:",e),null}};let f=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"proposalId",type:"uint256"}],name:"ProposalCancelled",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"proposalId",type:"uint256"},{indexed:!0,internalType:"address",name:"proposer",type:"address"},{indexed:!1,internalType:"string",name:"title",type:"string"},{indexed:!1,internalType:"uint8",name:"optionCount",type:"uint8"},{indexed:!1,internalType:"uint256",name:"startTime",type:"uint256"},{indexed:!1,internalType:"uint256",name:"endTime",type:"uint256"},{indexed:!1,internalType:"enum PrivateVotingDAOV2.ResultStrategy",name:"resultStrategy",type:"uint8"}],name:"ProposalCreated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"proposalId",type:"uint256"}],name:"ProposalEnded",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"proposalId",type:"uint256"},{indexed:!0,internalType:"address",name:"voter",type:"address"}],name:"VoteCast",type:"event"},{inputs:[{internalType:"uint256",name:"proposalId",type:"uint256"}],name:"allowResultsAccess",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"proposalId",type:"uint256"}],name:"cancelProposal",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"proposalId",type:"uint256"},{internalType:"externalEuint8",name:"encryptedOption",type:"bytes32"},{internalType:"bytes",name:"optionProof",type:"bytes"}],name:"castVote",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"string",name:"title",type:"string"},{internalType:"string",name:"description",type:"string"},{internalType:"string[]",name:"options",type:"string[]"},{internalType:"uint256",name:"duration",type:"uint256"},{internalType:"enum PrivateVotingDAOV2.ResultStrategy",name:"resultStrategy",type:"uint8"}],name:"createProposal",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"daoAdmin",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"proposalId",type:"uint256"}],name:"endProposal",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"proposalId",type:"uint256"}],name:"forceEndProposal",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"proposalId",type:"uint256"}],name:"getMyVote",outputs:[{internalType:"euint8",name:"encryptedOption",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"proposalId",type:"uint256"},{internalType:"uint8",name:"optionIndex",type:"uint8"}],name:"getOptionVotes",outputs:[{internalType:"euint32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"proposalId",type:"uint256"}],name:"getProposal",outputs:[{internalType:"uint256",name:"id",type:"uint256"},{internalType:"string",name:"title",type:"string"},{internalType:"string",name:"description",type:"string"},{internalType:"address",name:"proposer",type:"address"},{internalType:"uint256",name:"startTime",type:"uint256"},{internalType:"uint256",name:"endTime",type:"uint256"},{internalType:"string[]",name:"options",type:"string[]"},{internalType:"enum PrivateVotingDAOV2.ResultStrategy",name:"resultStrategy",type:"uint8"},{internalType:"enum PrivateVotingDAOV2.ProposalStatus",name:"status",type:"uint8"},{internalType:"bool",name:"resultsRevealed",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"proposalId",type:"uint256"}],name:"getProposalOptions",outputs:[{internalType:"string[]",name:"",type:"string[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"proposalId",type:"uint256"}],name:"getTotalVoters",outputs:[{internalType:"euint32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"user",type:"address"}],name:"getUserVotedProposals",outputs:[{internalType:"uint256[]",name:"",type:"uint256[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"proposalId",type:"uint256"},{internalType:"address",name:"voter",type:"address"}],name:"hasVoted",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"minQuorum",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"proposalCount",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"},{internalType:"uint8",name:"",type:"uint8"}],name:"proposalOptionVotes",outputs:[{internalType:"euint32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"proposalTotalVoters",outputs:[{internalType:"euint32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"proposals",outputs:[{internalType:"uint256",name:"id",type:"uint256"},{internalType:"string",name:"title",type:"string"},{internalType:"string",name:"description",type:"string"},{internalType:"address",name:"proposer",type:"address"},{internalType:"uint256",name:"startTime",type:"uint256"},{internalType:"uint256",name:"endTime",type:"uint256"},{internalType:"enum PrivateVotingDAOV2.ResultStrategy",name:"resultStrategy",type:"uint8"},{internalType:"enum PrivateVotingDAOV2.ProposalStatus",name:"status",type:"uint8"},{internalType:"bool",name:"resultsRevealed",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"protocolId",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"address",name:"newAdmin",type:"address"}],name:"setDaoAdmin",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"newQuorum",type:"uint256"}],name:"setMinQuorum",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"uint256",name:"",type:"uint256"}],name:"userVotedProposals",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"},{internalType:"address",name:"",type:"address"}],name:"userVotes",outputs:[{internalType:"euint8",name:"encryptedOption",type:"bytes32"},{internalType:"bool",name:"hasVoted",type:"bool"}],stateMutability:"view",type:"function"}];function N(){let[e,t]=(0,i.useState)(void 0),[s,l]=(0,i.useState)(!1);(0,i.useEffect)(()=>{l(!0),t(function(){var e;let t=null==(e=window.ethereum)?void 0:e.chainId;if(t)return({"0x7a69":"0x673B3b40fc67b78ef9CB5d95b902Ea6c4531212A","0xaa36a7":"0x39365615dBF518746Ae9e0e470707AF9CD813beF"})[t.toLowerCase()]}())},[]);let{proposals:r,proposalOptions:c,isLoading:o,message:u,createProposal:m,castVote:j,endProposal:N,forceEndProposal:w,allowResultsAccess:D,decryptResults:T,hasVoted:C,account:S,fhevmInstance:V}=function(e){let{contractAddress:t,contractABI:s}=e,{signer:n,readonlyProvider:l,fhevmInstance:r,isFhevmLoading:c,account:d,chainId:o,sameChainRef:u,sameSignerRef:p}=(0,b.z)(),m=(0,v.p)(),[x,y]=(0,i.useState)([]),[h,j]=(0,i.useState)(new Map),[f,N]=(0,i.useState)(!1),[w,D]=(0,i.useState)(""),T=(0,i.useCallback)(()=>{if(t&&l)return new g.NZ(t,s,l)},[t,s,l]),C=(0,i.useCallback)(()=>{if(t&&n)return new g.NZ(t,s,n)},[t,s,n]),S=(0,i.useCallback)(async()=>{let e=T();if(e)try{N(!0);let t=await e.proposalCount(),s=[],a=new Map;for(let n=1;n<=Number(t);n++){let t=await e.getProposal(n),i=await e.getProposalOptions(n);s.push({id:t.id,title:t.title,description:t.description,proposer:t.proposer,startTime:t.startTime,endTime:t.endTime,optionCount:i.length,resultStrategy:Number(t.resultStrategy),status:Number(t.status),resultsRevealed:t.resultsRevealed}),a.set(n,i)}y(s),j(a)}catch(e){D("Failed to load proposals: ".concat(e.message))}finally{N(!1)}},[T]),V=(0,i.useCallback)(async(e,t,s,a,n)=>{let i=C();if(!i)return void D("Contract not available");try{N(!0),D("Creating proposal...");let l=await i.createProposal(e,t,s,a,n);D("Waiting for transaction confirmation..."),await l.wait(),D("Proposal created successfully!"),await S()}catch(e){D("Failed to create proposal: ".concat(e.message))}finally{N(!1)}},[C,S]),P=(0,i.useCallback)(async(e,s)=>{let a=C();if(!a||!r||!d||!n)return void D("Prerequisites not met for voting");try{N(!0),D("Encrypting vote...");let i=await r.createEncryptedInput(t,n.address).add8(s.option).encrypt();D("Submitting vote...");let l=await a.castVote(e,i.handles[0],i.inputProof);D("Waiting for transaction confirmation..."),await l.wait(),D("Vote cast successfully!"),await S()}catch(e){D("Failed to cast vote: ".concat(e.message))}finally{N(!1)}},[C,r,d,n,t,S]),A=(0,i.useCallback)(async e=>{let t=C();if(!t)return void D("Contract not available");try{N(!0),D("Ending proposal...");let s=await t.endProposal(e);D("Waiting for transaction confirmation..."),await s.wait(),D("Proposal ended successfully!"),await S()}catch(e){D("Failed to end proposal: ".concat(e.message))}finally{N(!1)}},[C,S]),O=(0,i.useCallback)(async e=>{let t=C();if(!t)return void D("Contract not available");try{N(!0),D("Force ending proposal...");let s=await t.forceEndProposal(e);D("Waiting for transaction confirmation..."),await s.wait(),D("Proposal force ended successfully!"),await S()}catch(e){D("Failed to force end proposal: ".concat(e.message))}finally{N(!1)}},[C,S]),F=(0,i.useCallback)(async e=>{let t=C();if(!t)return void D("Contract not available");try{N(!0),D("Requesting results access...");let s=await t.allowResultsAccess(e);D("Waiting for transaction confirmation..."),await s.wait(),D("Results access granted!"),await S()}catch(e){D("Failed to allow results access: ".concat(e.message))}finally{N(!1)}},[C,S]),E=(0,i.useCallback)(async(e,s)=>{let i=T();if(!i||!r||!n)return void D("Prerequisites not met for decryption");try{N(!0),D("Getting decryption signature...");let l=await a.loadOrSign(r,[t],n,m);if(!l)return void D("Failed to get decryption signature");D("Fetching encrypted results...");let c=await i.getTotalVoters(e),d=[{handle:c,contractAddress:t}];for(let a=0;a<s;a++){let s=await i.getOptionVotes(e,a);d.push({handle:s,contractAddress:t})}D("Decrypting results...");let o=await r.userDecrypt(d,l.privateKey,l.publicKey,l.signature,l.contractAddresses,l.userAddress,l.startTimestamp,l.durationDays),u=BigInt(o[c]),p=[];for(let t=0;t<s;t++){let s=await i.getOptionVotes(e,t);p.push(BigInt(o[s]))}return D("Results decrypted successfully!"),{optionVotes:p,totalVoters:u}}catch(e){D("Failed to decrypt results: ".concat(e.message));return}finally{N(!1)}},[T,r,n,m,t]),I=(0,i.useCallback)(async(e,t)=>{let s=T();if(!s)return!1;try{return await s.hasVoted(e,t)}catch(e){return!1}},[T]);return(0,i.useEffect)(()=>{t&&l&&S()},[t,l,S]),{proposals:x,proposalOptions:h,isLoading:f||c,message:w,createProposal:V,castVote:P,endProposal:A,forceEndProposal:O,allowResultsAccess:F,decryptResults:E,hasVoted:I,loadProposals:S,account:d,fhevmInstance:r}}({contractAddress:e,contractABI:f}),[P,A]=(0,i.useState)(new Set),[O,F]=(0,i.useState)(!1);(0,i.useEffect)(()=>{S&&(async()=>{let e=new Set;for(let t of r)await C(Number(t.id),S)&&e.add(Number(t.id));A(e)})()},[r,S,C]);let E=!!e&&"0x0000000000000000000000000000000000000000"!==e;return s?(0,n.jsxs)("div",{className:"min-h-screen relative",children:[(0,n.jsx)("div",{className:"bg-decoration"}),(0,n.jsxs)("div",{className:"container mx-auto px-4 py-8 relative z-10",children:[(0,n.jsxs)("header",{className:"mb-8",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-5xl font-bold bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent mb-2",children:"\uD83C\uDFDB️ 隐私投票 DAO"}),(0,n.jsx)("p",{className:"text-gray-400 text-lg",children:"Privacy Voting DAO - Powered by FHEVM"})]}),(0,n.jsx)(d,{})]}),(0,n.jsxs)("div",{className:"card-glass p-4 space-y-2",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("span",{className:"text-gray-400",children:"钱包连接 | Wallet:"}),S?(0,n.jsx)("span",{className:"text-green-400 flex items-center gap-2",children:"✅ 已连接 | Connected"}):(0,n.jsx)("span",{className:"text-yellow-400 flex items-center gap-2",children:"⚠️ 未连接 | Not Connected"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("span",{className:"text-gray-400",children:"FHEVM 实例 | Instance:"}),V?(0,n.jsx)("span",{className:"text-green-400 flex items-center gap-2",children:"✅ 已初始化 | Initialized"}):(0,n.jsx)("span",{className:"text-yellow-400 flex items-center gap-2",children:"⏳ 初始化中... | Initializing..."})]}),(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("span",{className:"text-gray-400",children:"智能合约 | Contract:"}),E?(0,n.jsx)("span",{className:"text-green-400 flex items-center gap-2",children:"✅ 已部署 | Deployed"}):(0,n.jsx)("span",{className:"text-red-400 flex items-center gap-2",children:"❌ 未部署 | Not Deployed"})]})]})]}),!E&&(0,n.jsxs)("div",{className:"card-glass p-6 mb-8 border-red-500/50",children:[(0,n.jsx)("h2",{className:"text-xl font-bold text-red-400 mb-2",children:"❌ 合约未部署"}),(0,n.jsx)("p",{className:"text-gray-300 mb-4",children:"PrivateVotingDAOV2 合约尚未部署，请先部署合约。"}),(0,n.jsx)("p",{className:"text-sm text-gray-400 font-mono",children:"cd fhevm-hardhat-template && npx hardhat deploy --tags PrivateVotingDAOV2"})]}),u&&(0,n.jsx)("div",{className:"card-glass p-4 mb-8 border-blue-500/50 pulse-glow",children:(0,n.jsxs)("p",{className:"text-blue-300 flex items-center gap-2",children:[(0,n.jsx)("span",{className:"animate-pulse",children:"ℹ️"}),u]})}),(0,n.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,n.jsxs)("div",{className:"lg:col-span-2 space-y-8",children:[(0,n.jsx)("div",{children:(0,n.jsx)("button",{onClick:()=>F(!O),disabled:!S||!V||!E,className:"btn-primary w-full disabled:opacity-50 disabled:cursor-not-allowed",children:O?"❌ 取消创建":"➕ 创建新提案"})}),O&&(0,n.jsx)(p,{onSubmit:(e,t,s,a,n)=>{m(e,t,s,a,n),F(!1)},isLoading:o}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("h2",{className:"text-3xl font-bold text-white mb-6 flex items-center gap-3",children:["\uD83D\uDDF3️ 活跃提案",(0,n.jsxs)("span",{className:"text-lg text-gray-400",children:["(",r.length,")"]})]}),0===r.length?(0,n.jsxs)("div",{className:"card-glass p-12 text-center",children:[(0,n.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDDF3️"}),(0,n.jsx)("p",{className:"text-gray-400 text-lg",children:"暂无提案"}),(0,n.jsx)("p",{className:"text-gray-500 text-sm mt-2",children:"快来创建第一个提案吧！"})]}):(0,n.jsx)("div",{className:"space-y-6",children:r.map(e=>(0,n.jsx)(x,{proposal:e,hasVoted:P.has(Number(e.id)),canVote:!!S&&!!V,onVote:j,onEnd:N,onForceEnd:w,onAllowResults:D,onDecryptResults:T,isLoading:o,options:c.get(Number(e.id))||[],currentUserAddress:S},e.id.toString()))})]})]}),(0,n.jsxs)("div",{className:"space-y-8",children:[(0,n.jsx)(h,{proposals:r,userAddress:S,votedProposalIds:P}),(0,n.jsx)(y,{proposals:r})]})]}),(0,n.jsx)("footer",{className:"mt-16 text-center text-gray-500 text-sm",children:(0,n.jsxs)("div",{className:"card-glass p-6",children:[(0,n.jsx)("p",{className:"mb-2",children:"\uD83D\uDD12 基于 FHEVM 的端到端加密投票系统"}),(0,n.jsx)("p",{children:"Built with ❤️ using Zama's Fully Homomorphic Encryption"})]})})]})]}):(0,n.jsxs)("div",{className:"min-h-screen relative flex items-center justify-center",children:[(0,n.jsx)("div",{className:"bg-decoration"}),(0,n.jsxs)("div",{className:"text-center relative z-10",children:[(0,n.jsx)("div",{className:"text-6xl mb-4 animate-pulse",children:"\uD83C\uDFDB️"}),(0,n.jsx)("div",{className:"text-xl text-gray-300",children:"正在加载..."})]})]})}}},e=>{e.O(0,[183,338,441,255,358],()=>e(e.s=4030)),_N_E=e.O()}]);