"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[338],{3139:(e,t,r)=>{r.d(t,{r:()=>i,U:()=>c});var a=r(5155),n=r(2115);let o=(0,n.createContext)(void 0);function i(e){let{children:t}=e,r=function(){let[e,t]=(0,n.useState)([]);return(0,n.useEffect)(()=>{let e=e=>{t(t=>t.find(t=>t.info.uuid===e.detail.info.uuid)?t:[...t,e.detail])};return window.addEventListener("eip6963:announceProvider",e),window.dispatchEvent(new Event("eip6963:requestProvider")),()=>{window.removeEventListener("eip6963:announceProvider",e)}},[]),e}(),[i,c]=(0,n.useState)(),[l,s]=(0,n.useState)(),[d,u]=(0,n.useState)();(0,n.useEffect)(()=>{let e=r.find(e=>e.info.name.toLowerCase().includes("metamask"));e&&!i&&c(e.provider)},[r,i]),(0,n.useEffect)(()=>{var e,t;if(!i)return;let r=e=>{Array.isArray(e)&&e.length>0?s(e[0]):s(void 0)},a=e=>{"string"==typeof e&&u(parseInt(e,16))};return null==(e=i.on)||e.call(i,"accountsChanged",r),null==(t=i.on)||t.call(i,"chainChanged",a),i.request({method:"eth_accounts"}).then(e=>{Array.isArray(e)&&e.length>0&&s(e[0])}).catch(console.error),i.request({method:"eth_chainId"}).then(e=>{"string"==typeof e&&u(parseInt(e,16))}).catch(console.error),()=>{var e,t;null==(e=i.removeListener)||e.call(i,"accountsChanged",r),null==(t=i.removeListener)||t.call(i,"chainChanged",a)}},[i]);let h=(0,n.useCallback)(async()=>{if(!i)throw Error("No provider available");try{let e=await i.request({method:"eth_requestAccounts"});Array.isArray(e)&&e.length>0&&s(e[0])}catch(e){throw console.error("Failed to connect:",e),e}},[i]),y=(0,n.useCallback)(()=>{s(void 0)},[]),f=(0,n.useCallback)(async e=>{if(!i)throw Error("No provider available");try{await i.request({method:"wallet_switchEthereumChain",params:[{chainId:"0x".concat(e.toString(16))}]})}catch(t){if(4902===t.code)31337===e&&await i.request({method:"wallet_addEthereumChain",params:[{chainId:"0x7a69",chainName:"Localhost 8545",nativeCurrency:{name:"ETH",symbol:"ETH",decimals:18},rpcUrls:["http://localhost:8545"]}]});else throw t}},[i]);return(0,a.jsx)(o.Provider,{value:{provider:i,selectedAccount:l,chainId:d,connect:h,disconnect:y,switchChain:f},children:t})}function c(){let e=(0,n.useContext)(o);if(!e)throw Error("useMetaMaskProvider must be used within MetaMaskProvider");return e}},6916:(e,t,r)=>{r.d(t,{h:()=>c,p:()=>l});var a=r(5155),n=r(2115);class o{async getItem(e){return this.store.get(e)||null}async setItem(e,t){this.store.set(e,t)}async removeItem(e){this.store.delete(e)}constructor(){this.store=new Map}}let i=(0,n.createContext)(void 0);function c(e){let{children:t}=e,r=(0,n.useRef)(new o);return(0,a.jsx)(i.Provider,{value:r.current,children:t})}function l(){let e=(0,n.useContext)(i);if(!e)throw Error("useInMemoryStorage must be used within InMemoryStorageProvider");return e}},8343:(e,t,r)=>{let a;r.d(t,{S:()=>M,z:()=>j});var n=r(5155),o=r(2115),i=r(1012),c=r(3139),l=r(4827),s=r(6037);let d="https://cdn.zama.ai/relayer-sdk-js/0.2.0/relayer-sdk-js.umd.cjs";class u{isLoaded(){return y(window,this._trace)}load(){if("relayerSDK"in window){if(!h(window.relayerSDK,this._trace))throw Error("RelayerSDKLoader: Unable to load FHEVM Relayer SDK");return Promise.resolve()}return new Promise((e,t)=>{if(document.querySelector('script[src="'.concat(d,'"]'))){y(window,this._trace)||t(Error("RelayerSDKLoader: window object does not contain a valid relayerSDK object.")),e();return}let r=document.createElement("script");r.src=d,r.type="text/javascript",r.async=!0,r.onload=()=>{y(window,this._trace)||t(Error("RelayerSDKLoader: Relayer SDK script has been successfully loaded from ".concat(d,", however, the window.relayerSDK object is invalid."))),e()},r.onerror=()=>{t(Error("RelayerSDKLoader: Failed to load Relayer SDK from ".concat(d)))},document.head.appendChild(r)})}constructor(e){this._trace=e.trace}}function h(e,t){return void 0===e?(null==t||t("RelayerSDKLoader: relayerSDK is undefined"),!1):null===e?(null==t||t("RelayerSDKLoader: relayerSDK is null"),!1):"object"!=typeof e?(null==t||t("RelayerSDKLoader: relayerSDK is not an object"),!1):f(e,"initSDK","function",t)?f(e,"createInstance","function",t)?f(e,"SepoliaConfig","object",t)?!("__initialized__"in e)||!0===e.__initialized__||!1===e.__initialized__||(null==t||t("RelayerSDKLoader: relayerSDK.__initialized__ is invalid"),!1):(null==t||t("RelayerSDKLoader: relayerSDK.SepoliaConfig is invalid"),!1):(null==t||t("RelayerSDKLoader: relayerSDK.createInstance is invalid"),!1):(null==t||t("RelayerSDKLoader: relayerSDK.initSDK is invalid"),!1)}function y(e,t){return void 0===e?(null==t||t("RelayerSDKLoader: window object is undefined"),!1):null===e?(null==t||t("RelayerSDKLoader: window object is null"),!1):"object"!=typeof e?(null==t||t("RelayerSDKLoader: window is not an object"),!1):"relayerSDK"in e?h(e.relayerSDK):(null==t||t("RelayerSDKLoader: window does not contain 'relayerSDK' property"),!1)}function f(e,t,r,a){if(!e||"object"!=typeof e)return!1;if(!(t in e))return null==a||a("RelayerSDKLoader: missing ".concat(String(t),".")),!1;let n=e[t];return null==n?(null==a||a("RelayerSDKLoader: ".concat(String(t)," is null or undefined.")),!1):typeof n===r||(null==a||a("RelayerSDKLoader: ".concat(String(t)," is not a ").concat(r,".")),!1)}var w=r(3899),m=r(5376).Buffer;let g="keys";function v(){return a||(a=(0,w.P2)("fhevm-public-keys",2,{upgrade(e,t,r,a){t<1&&!e.objectStoreNames.contains(g)&&e.createObjectStore(g,{keyPath:"aclAddress"}),t<2&&e.objectStoreNames.contains(g)&&(a.objectStore(g).clear(),console.log("[PublicKeyStorage] Cleared old cache during DB upgrade"))}})),a}function p(e){if(void 0!==m)return m.from(e).toString("base64");let t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return btoa(t)}function S(e){if(void 0!==m)return new Uint8Array(m.from(e,"base64"));let t=atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r}async function b(e){let t=await v(),r=await t.get(g,e);if(r&&r.publicKey&&r.publicParams){if("string"!=typeof r.publicKey||"string"!=typeof r.publicParams)return console.warn("[PublicKeyStorage] Cached data is in old format (not Base64 strings), clearing cache..."),await K(e,"",""),{publicKey:"",publicParams:""};try{return{publicKey:S(r.publicKey),publicParams:S(r.publicParams)}}catch(t){console.error("[PublicKeyStorage] Failed to decode Base64 keys, clearing cache:",t),await K(e,"","")}}return{publicKey:"",publicParams:""}}async function K(e,t,r){let a=await v(),n=t instanceof Uint8Array?p(t):t,o=r instanceof Uint8Array?p(r):r;await a.put(g,{aclAddress:e,publicKey:n,publicParams:o})}class F extends Error{constructor(e,t,r){super(t,r),this.code=e,this.name="FhevmReactError"}}function E(e,t,r){throw new F(e,t,r?{cause:r}:void 0)}let I=async e=>{if(!y(window,console.log))throw Error("window.relayerSDK is not available");let t=await window.relayerSDK.initSDK(e);if(window.relayerSDK.__initialized__=t,!t)throw Error("window.relayerSDK.initSDK failed.");return!0};class D extends Error{constructor(e="FHEVM operation was cancelled"){super(e),this.name="FhevmAbortError"}}async function C(e){if("string"==typeof e){let t=new s.FR(e);return Number((await t.getNetwork()).chainId)}return Number.parseInt(await e.request({method:"eth_chainId"}),16)}async function k(e){let t=new s.FR(e);try{return await t.send("web3_clientVersion",[])}catch(t){E("WEB3_CLIENTVERSION_ERROR","The URL ".concat(e," is not a Web3 node or is not reachable. Please check the endpoint."),t)}finally{t.destroy()}}async function _(e){let t=await k(e);if("string"==typeof t&&t.toLowerCase().includes("hardhat"))try{let t=await R(e);if(!t||"object"!=typeof t||!("ACLAddress"in t&&"string"==typeof t.ACLAddress&&t.ACLAddress.startsWith("0x"))||!("InputVerifierAddress"in t&&"string"==typeof t.InputVerifierAddress&&t.InputVerifierAddress.startsWith("0x"))||!("KMSVerifierAddress"in t&&"string"==typeof t.KMSVerifierAddress&&t.KMSVerifierAddress.startsWith("0x")))return;return t}catch(e){return}}async function R(e){let t=new s.FR(e);try{return await t.send("fhevm_relayer_metadata",[])}catch(t){E("FHEVM_RELAYER_METADATA_ERROR","The URL ".concat(e," is not a FHEVM Hardhat node or is not reachable. Please check the endpoint."),t)}finally{t.destroy()}}async function A(e,t){let r=await C(e),a="string"==typeof e?e:void 0,n={31337:"http://localhost:8545",...null!=t?t:{}};return Object.hasOwn(n,r)?(a||(a=n[r]),{isMock:!0,chainId:r,rpcUrl:a}):{isMock:!1,chainId:r,rpcUrl:a}}let P=async e=>{let t=()=>{if(n.aborted)throw new D},a=e=>{o&&o(e)},{signal:n,onStatusChange:o,provider:i,mockChains:c}=e;console.log("[createFhevmInstance] Starting with provider:",i);let{isMock:s,rpcUrl:d,chainId:h}=await A(i,c);if(console.log("[createFhevmInstance] Resolved:",{isMock:s,rpcUrl:d,chainId:h}),s){console.log("[createFhevmInstance] Detected mock mode, checking FHEVM metadata...");let e=await _(d);if(console.log("[createFhevmInstance] FHEVM metadata:",e),e){a("creating"),console.log("[createFhevmInstance] Creating mock instance with metadata:",e);let n=await r.e(79).then(r.bind(r,7079));try{let r=await n.fhevmMockCreateInstance({rpcUrl:d,chainId:h,metadata:e});return console.log("[createFhevmInstance] Mock instance created successfully!"),t(),r}catch(e){throw console.error("[createFhevmInstance] Failed to create mock instance:",e),e}}console.warn("[createFhevmInstance] No FHEVM metadata found, falling back to relayer SDK")}if(t(),console.log("[createFhevmInstance] Checking if FHEVM SDK is loaded..."),y(window,console.log))console.log("[createFhevmInstance] SDK already loaded");else{console.log("[createFhevmInstance] SDK not loaded, loading from CDN..."),a("sdk-loading");try{await new u({trace:console.log}).load(),console.log("[createFhevmInstance] SDK loaded successfully!"),t(),a("sdk-loaded")}catch(e){throw console.error("[createFhevmInstance] Failed to load SDK:",e),e}}if(console.log("[createFhevmInstance] Checking if FHEVM is initialized..."),y(window,console.log)&&!0===window.relayerSDK.__initialized__)console.log("[createFhevmInstance] FHEVM already initialized");else{console.log("[createFhevmInstance] Initializing FHEVM..."),a("sdk-initializing");try{await I(),console.log("[createFhevmInstance] FHEVM initialized successfully!"),t(),a("sdk-initialized")}catch(e){throw console.error("[createFhevmInstance] Failed to initialize FHEVM:",e),e}}let f=window.relayerSDK;console.log("[createFhevmInstance] RelayerSDK retrieved:",f);let w=f.SepoliaConfig.aclContractAddress;if(console.log("[createFhevmInstance] ACL Address:",w),!function(e){return"string"==typeof e&&!!(0,l.PW)(e)}(w))throw Error("Invalid address: ".concat(w));console.log("[createFhevmInstance] Getting public key from storage...");let m=await b(w);t();let g=m.publicKey instanceof Uint8Array&&m.publicKey.length>0,v=m.publicParams instanceof Uint8Array&&m.publicParams.length>0;console.log("[createFhevmInstance] Cache status:",{hasKey:g,hasParams:v,keyType:g?"Uint8Array":typeof m.publicKey,keyLength:g?m.publicKey.length:0});let p={...f.SepoliaConfig,network:i,...g?{publicKey:m.publicKey}:{},...v?{publicParams:m.publicParams}:{}};g&&v?console.log("[createFhevmInstance] ✅ Using cached public key (Uint8Array)"):console.log("[createFhevmInstance] Public key not in cache, SDK will fetch from network"),a("creating"),console.log("[createFhevmInstance] Creating FHEVM instance...");try{let e=await f.createInstance(p);console.log("[createFhevmInstance] Instance created successfully!");try{let t=e.getPublicKey(),r=e.getPublicParams(2048);console.log("[createFhevmInstance] Saving public key to cache (Uint8Array → Base64)..."),await K(w,t,r),console.log("[createFhevmInstance] ✅ Public key cached successfully")}catch(e){console.error("[createFhevmInstance] ⚠️ Failed to cache public key (non-fatal):",e)}return t(),e}catch(e){console.error("[createFhevmInstance] ❌ Failed to create instance:",e),console.error("[createFhevmInstance] Error details:",{message:(null==e?void 0:e.message)||String(e),hadCachedKey:g,hadCachedParams:v});try{console.log("[createFhevmInstance] Clearing cache to force fresh fetch on next attempt..."),await K(w,"",""),console.log("[createFhevmInstance] Cache cleared")}catch(e){console.error("[createFhevmInstance] Failed to clear cache:",e)}throw e}},L=(0,o.createContext)(void 0);function M(e){let{children:t,initialMockChains:r}=e,{provider:a,selectedAccount:l,chainId:s}=(0,c.U)(),[d,u]=(0,o.useState)(),[h,y]=(0,o.useState)(),f=(0,o.useRef)(d),w=(0,o.useRef)(s);(0,o.useEffect)(()=>{f.current=d},[d]),(0,o.useEffect)(()=>{w.current=s},[s]);let m=(0,o.useRef)(()=>!1),g=(0,o.useRef)(()=>!1);m.current=(0,o.useCallback)(e=>e===w.current,[]),g.current=(0,o.useCallback)(e=>e===f.current,[]);let{instance:v,isLoading:p,error:S}=function(e){let{provider:t,mockChains:r}=e,[a,n]=(0,o.useState)(void 0),[i,c]=(0,o.useState)(!1),[l,s]=(0,o.useState)(void 0),d=(0,o.useRef)(void 0),u=(0,o.useCallback)(async()=>{if(!t)return void n(void 0);d.current&&d.current.abort();let e=new AbortController;d.current=e,c(!0),s(void 0);try{let a=await P({provider:t,mockChains:r,signal:e.signal});e.signal.aborted||(n(a),c(!1))}catch(t){e.signal.aborted||(s((null==t?void 0:t.message)||"Failed to create FHEVM instance"),c(!1))}},[t,r]);return(0,o.useEffect)(()=>(u(),()=>{d.current&&d.current.abort()}),[u]),{instance:a,isLoading:i,error:l,recreate:u}}({provider:a,mockChains:r});(0,o.useEffect)(()=>{if(!a||!l){u(void 0),y(void 0);return}let e=new i.k(a);e.getSigner(l).then(u),y(e)},[a,l,s]);let b=(0,o.useMemo)(()=>({signer:d,readonlyProvider:h,fhevmInstance:v,isFhevmLoading:p,fhevmError:S,chainId:s,account:l,sameChainRef:m,sameSignerRef:g}),[d,h,v,p,S,s,l]);return(0,n.jsx)(L.Provider,{value:b,children:t})}function j(){let e=(0,o.useContext)(L);if(!e)throw Error("useMetaMaskEthersSigner must be used within MetaMaskEthersSignerProvider");return e}}}]);